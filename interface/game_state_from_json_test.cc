
#include "interface/game_state_from_json.hh"

#include "gtest/gtest.h"

namespace sts::interface {
TEST(GameStateFromJsonTest, ParseMainMenu) {
  const nlohmann::json json = nlohmann::json::parse(
      R"json({"available_commands":["start","state"],"ready_for_command":true,"in_game":false})json");
  const GameState game_state = game_state_from_json(json);
  EXPECT_EQ(game_state.available_commands.size(), 2);
  EXPECT_TRUE(game_state.available_commands.contains("start"));
  EXPECT_TRUE(game_state.available_commands.contains("state"));
  EXPECT_EQ(game_state.in_game, false);
  EXPECT_EQ(game_state.ready_for_command, true);
}

TEST(GameStateFromJsonTest, ParseNeowRoom) {
  const nlohmann::json json = nlohmann::json::parse(
      R"({"available_commands":["choose","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Hexaghost","action_phase":"WAITING_ON_USER","ascension_level":0,"choice_list":["talk"],"class":"IRONCLAD","current_hp":80,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"81023f5e-4389-43db-8825-9139256377e4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"ee0852dc-a1cb-4dbd-af79-1a3451d1e17a"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"277302c9-fc78-473c-91b8-a5e057b50627"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"15020a2b-0278-4d5d-a8b7-43fa39dd5d30"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"6b9fe09c-83c2-4f8e-a90b-d46231539b6d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"320db35f-b5de-4936-a927-ab14b51b33be"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"f37b504e-1ae6-4be6-a0ec-a8f4a201ee58"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"388ebca0-e9f8-4036-a270-8736ef2a70db"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"556e248d-f92f-4099-87bf-9018f8d6890e"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"fec06361-8b20-431d-a359-45396904bc48"}],"floor":0,"gold":99,"is_screen_up":false,"map":[{"children":[{"x":1,"y":1}],"parents":[],"symbol":"M","x":1,"y":0},{"children":[{"x":2,"y":1},{"x":3,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":5,"y":1}],"parents":[],"symbol":"M","x":5,"y":0},{"children":[{"x":6,"y":1}],"parents":[],"symbol":"M","x":6,"y":0},{"children":[{"x":1,"y":2}],"parents":[],"symbol":"M","x":1,"y":1},{"children":[{"x":2,"y":2}],"parents":[],"symbol":"M","x":2,"y":1},{"children":[{"x":4,"y":2}],"parents":[],"symbol":"$","x":3,"y":1},{"children":[{"x":5,"y":2},{"x":6,"y":2}],"parents":[],"symbol":"M","x":5,"y":1},{"children":[{"x":6,"y":2}],"parents":[],"symbol":"M","x":6,"y":1},{"children":[{"x":0,"y":3}],"parents":[],"symbol":"?","x":1,"y":2},{"children":[{"x":1,"y":3}],"parents":[],"symbol":"M","x":2,"y":2},{"children":[{"x":3,"y":3}],"parents":[],"symbol":"M","x":4,"y":2},{"children":[{"x":4,"y":3}],"parents":[],"symbol":"?","x":5,"y":2},{"children":[{"x":5,"y":3},{"x":6,"y":3}],"parents":[],"symbol":"M","x":6,"y":2},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":0,"y":3},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":1,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"M","x":3,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"M","x":4,"y":3},{"children":[{"x":5,"y":4}],"parents":[],"symbol":"?","x":5,"y":3},{"children":[{"x":5,"y":4}],"parents":[],"symbol":"$","x":6,"y":3},{"children":[{"x":1,"y":5}],"parents":[],"symbol":"M","x":1,"y":4},{"children":[{"x":3,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":5,"y":5},{"x":6,"y":5}],"parents":[],"symbol":"M","x":5,"y":4},{"children":[{"x":0,"y":6}],"parents":[],"symbol":"R","x":1,"y":5},{"children":[{"x":3,"y":6},{"x":4,"y":6}],"parents":[],"symbol":"E","x":3,"y":5},{"children":[{"x":4,"y":6}],"parents":[],"symbol":"E","x":5,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"R","x":6,"y":5},{"children":[{"x":1,"y":7}],"parents":[],"symbol":"E","x":0,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"?","x":3,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"M","x":4,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"?","x":5,"y":6},{"children":[{"x":1,"y":8}],"parents":[],"symbol":"M","x":1,"y":7},{"children":[{"x":4,"y":8}],"parents":[],"symbol":"?","x":4,"y":7},{"children":[{"x":4,"y":8}],"parents":[],"symbol":"M","x":5,"y":7},{"children":[{"x":2,"y":9}],"parents":[],"symbol":"T","x":1,"y":8},{"children":[{"x":3,"y":9},{"x":4,"y":9},{"x":5,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":1,"y":10},{"x":3,"y":10}],"parents":[],"symbol":"?","x":2,"y":9},{"children":[{"x":3,"y":10}],"parents":[],"symbol":"?","x":3,"y":9},{"children":[{"x":3,"y":10}],"parents":[],"symbol":"M","x":4,"y":9},{"children":[{"x":5,"y":10}],"parents":[],"symbol":"R","x":5,"y":9},{"children":[{"x":1,"y":11}],"parents":[],"symbol":"?","x":1,"y":10},{"children":[{"x":2,"y":11},{"x":3,"y":11}],"parents":[],"symbol":"R","x":3,"y":10},{"children":[{"x":6,"y":11}],"parents":[],"symbol":"?","x":5,"y":10},{"children":[{"x":1,"y":12}],"parents":[],"symbol":"M","x":1,"y":11},{"children":[{"x":2,"y":12}],"parents":[],"symbol":"?","x":2,"y":11},{"children":[{"x":3,"y":12}],"parents":[],"symbol":"M","x":3,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":6,"y":11},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"E","x":1,"y":12},{"children":[{"x":1,"y":13},{"x":2,"y":13}],"parents":[],"symbol":"M","x":2,"y":12},{"children":[{"x":3,"y":13}],"parents":[],"symbol":"$","x":3,"y":12},{"children":[{"x":6,"y":13}],"parents":[],"symbol":"?","x":5,"y":12},{"children":[{"x":0,"y":14},{"x":2,"y":14}],"parents":[],"symbol":"M","x":1,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"M","x":2,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"M","x":3,"y":13},{"children":[{"x":6,"y":14}],"parents":[],"symbol":"M","x":6,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":0,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":2,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":6,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"}],"room_phase":"EVENT","room_type":"NeowRoom","screen_name":"NONE","screen_state":{"body_text":"","event_id":"Neow Event","event_name":"Neow","options":[{"choice_index":0,"disabled":false,"label":"Talk","text":"[Talk]"}]},"screen_type":"EVENT","seed":-4286266658286363541},"in_game":true,"ready_for_command":true})");
  const GameState game_state = game_state_from_json(json);
}

TEST(GameStateFromJsonTest, ParseMapScreen) {
  const nlohmann::json json = nlohmann::json::parse(
      R"json({"available_commands":["choose","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Hexaghost","action_phase":"WAITING_ON_USER","ascension_level":0,"choice_list":["talk"],"class":"IRONCLAD","current_hp":80,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"81023f5e-4389-43db-8825-9139256377e4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"ee0852dc-a1cb-4dbd-af79-1a3451d1e17a"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"277302c9-fc78-473c-91b8-a5e057b50627"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"15020a2b-0278-4d5d-a8b7-43fa39dd5d30"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"6b9fe09c-83c2-4f8e-a90b-d46231539b6d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"320db35f-b5de-4936-a927-ab14b51b33be"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"f37b504e-1ae6-4be6-a0ec-a8f4a201ee58"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"388ebca0-e9f8-4036-a270-8736ef2a70db"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"556e248d-f92f-4099-87bf-9018f8d6890e"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"fec06361-8b20-431d-a359-45396904bc48"}],"floor":0,"gold":99,"is_screen_up":false,"map":[{"children":[{"x":1,"y":1}],"parents":[],"symbol":"M","x":1,"y":0},{"children":[{"x":2,"y":1},{"x":3,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":5,"y":1}],"parents":[],"symbol":"M","x":5,"y":0},{"children":[{"x":6,"y":1}],"parents":[],"symbol":"M","x":6,"y":0},{"children":[{"x":1,"y":2}],"parents":[],"symbol":"M","x":1,"y":1},{"children":[{"x":2,"y":2}],"parents":[],"symbol":"M","x":2,"y":1},{"children":[{"x":4,"y":2}],"parents":[],"symbol":"$","x":3,"y":1},{"children":[{"x":5,"y":2},{"x":6,"y":2}],"parents":[],"symbol":"M","x":5,"y":1},{"children":[{"x":6,"y":2}],"parents":[],"symbol":"M","x":6,"y":1},{"children":[{"x":0,"y":3}],"parents":[],"symbol":"?","x":1,"y":2},{"children":[{"x":1,"y":3}],"parents":[],"symbol":"M","x":2,"y":2},{"children":[{"x":3,"y":3}],"parents":[],"symbol":"M","x":4,"y":2},{"children":[{"x":4,"y":3}],"parents":[],"symbol":"?","x":5,"y":2},{"children":[{"x":5,"y":3},{"x":6,"y":3}],"parents":[],"symbol":"M","x":6,"y":2},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":0,"y":3},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":1,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"M","x":3,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"M","x":4,"y":3},{"children":[{"x":5,"y":4}],"parents":[],"symbol":"?","x":5,"y":3},{"children":[{"x":5,"y":4}],"parents":[],"symbol":"$","x":6,"y":3},{"children":[{"x":1,"y":5}],"parents":[],"symbol":"M","x":1,"y":4},{"children":[{"x":3,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":5,"y":5},{"x":6,"y":5}],"parents":[],"symbol":"M","x":5,"y":4},{"children":[{"x":0,"y":6}],"parents":[],"symbol":"R","x":1,"y":5},{"children":[{"x":3,"y":6},{"x":4,"y":6}],"parents":[],"symbol":"E","x":3,"y":5},{"children":[{"x":4,"y":6}],"parents":[],"symbol":"E","x":5,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"R","x":6,"y":5},{"children":[{"x":1,"y":7}],"parents":[],"symbol":"E","x":0,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"?","x":3,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"M","x":4,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"?","x":5,"y":6},{"children":[{"x":1,"y":8}],"parents":[],"symbol":"M","x":1,"y":7},{"children":[{"x":4,"y":8}],"parents":[],"symbol":"?","x":4,"y":7},{"children":[{"x":4,"y":8}],"parents":[],"symbol":"M","x":5,"y":7},{"children":[{"x":2,"y":9}],"parents":[],"symbol":"T","x":1,"y":8},{"children":[{"x":3,"y":9},{"x":4,"y":9},{"x":5,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":1,"y":10},{"x":3,"y":10}],"parents":[],"symbol":"?","x":2,"y":9},{"children":[{"x":3,"y":10}],"parents":[],"symbol":"?","x":3,"y":9},{"children":[{"x":3,"y":10}],"parents":[],"symbol":"M","x":4,"y":9},{"children":[{"x":5,"y":10}],"parents":[],"symbol":"R","x":5,"y":9},{"children":[{"x":1,"y":11}],"parents":[],"symbol":"?","x":1,"y":10},{"children":[{"x":2,"y":11},{"x":3,"y":11}],"parents":[],"symbol":"R","x":3,"y":10},{"children":[{"x":6,"y":11}],"parents":[],"symbol":"?","x":5,"y":10},{"children":[{"x":1,"y":12}],"parents":[],"symbol":"M","x":1,"y":11},{"children":[{"x":2,"y":12}],"parents":[],"symbol":"?","x":2,"y":11},{"children":[{"x":3,"y":12}],"parents":[],"symbol":"M","x":3,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":6,"y":11},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"E","x":1,"y":12},{"children":[{"x":1,"y":13},{"x":2,"y":13}],"parents":[],"symbol":"M","x":2,"y":12},{"children":[{"x":3,"y":13}],"parents":[],"symbol":"$","x":3,"y":12},{"children":[{"x":6,"y":13}],"parents":[],"symbol":"?","x":5,"y":12},{"children":[{"x":0,"y":14},{"x":2,"y":14}],"parents":[],"symbol":"M","x":1,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"M","x":2,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"M","x":3,"y":13},{"children":[{"x":6,"y":14}],"parents":[],"symbol":"M","x":6,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":0,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":2,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":6,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"}],"room_phase":"EVENT","room_type":"NeowRoom","screen_name":"NONE","screen_state":{"body_text":"","event_id":"Neow Event","event_name":"Neow","options":[{"choice_index":0,"disabled":false,"label":"Talk","text":"[Talk]"}]},"screen_type":"EVENT","seed":-4286266658286363541},"in_game":true,"ready_for_command":true})json");
  const GameState game_state = game_state_from_json(json);
}

TEST(GameStateFromJsonTest, ParseCombatScreen) {
  const nlohmann::
      json
          json = nlohmann::json::parse(R"({"available_commands":["play","end","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Hexaghost","action_phase":"WAITING_ON_USER","ascension_level":0,"class":"IRONCLAD","combat_state":{"cards_discarded_this_turn":0,"discard_pile":[],"draw_pile":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"928f852c-a42e-4fee-bc8f-199e7cbbaed0"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"72d0c138-2a04-47bb-8680-6b08c7b4a4a4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"082df39b-2903-4e22-9eb7-08cc72fea6f9"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"e972855f-ae9f-49d5-90ee-40fab10d77f2"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"28ac761d-bbc2-4f71-bddf-8a2dd0da33a3"}],"exhaust_pile":[],"hand":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"fb9c1c59-ce35-4712-b189-b1d51aa86a28"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","is_playable":true,"name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"c6a17368-811e-4497-8779-871e293fd103"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"d9623aea-f85d-426c-9ab7-b27db5b27f6a"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"23152fb2-a901-4ac9-8299-9c109473d37a"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"adeb2842-3557-480e-9ca9-cb134bbe248d"}],"limbo":[],"monsters":[{"block":0,"current_hp":1,"half_dead":false,"id":"FuzzyLouseNormal","intent":"BUFF","is_gone":false,"max_hp":12,"move_adjusted_damage":-1,"move_base_damage":-1,"move_hits":1,"move_id":4,"name":"Louse","powers":[{"amount":4,"id":"Curl Up","name":"Curl Up"}]},{"block":0,"current_hp":1,"half_dead":false,"id":"FuzzyLouseDefensive","intent":"ATTACK","is_gone":false,"max_hp":16,"move_adjusted_damage":6,"move_base_damage":6,"move_hits":1,"move_id":3,"name":"Louse","powers":[{"amount":4,"id":"Curl Up","name":"Curl Up"}]}],"player":{"block":0,"current_hp":80,"energy":3,"max_hp":80,"orbs":[],"powers":[]},"times_damaged":0,"turn":1},"current_hp":80,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"28ac761d-bbc2-4f71-bddf-8a2dd0da33a3"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"23152fb2-a901-4ac9-8299-9c109473d37a"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"72d0c138-2a04-47bb-8680-6b08c7b4a4a4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"928f852c-a42e-4fee-bc8f-199e7cbbaed0"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":true,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"fb9c1c59-ce35-4712-b189-b1d51aa86a28"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"adeb2842-3557-480e-9ca9-cb134bbe248d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"e972855f-ae9f-49d5-90ee-40fab10d77f2"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"082df39b-2903-4e22-9eb7-08cc72fea6f9"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":true,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"d9623aea-f85d-426c-9ab7-b27db5b27f6a"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","is_playable":true,"name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"c6a17368-811e-4497-8779-871e293fd103"}],"floor":1,"gold":99,"is_screen_up":false,"map":[{"children":[{"x":0,"y":1},{"x":1,"y":1}],"parents":[],"symbol":"M","x":0,"y":0},{"children":[{"x":2,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":5,"y":1}],"parents":[],"symbol":"M","x":4,"y":0},{"children":[{"x":0,"y":2}],"parents":[],"symbol":"M","x":0,"y":1},{"children":[{"x":2,"y":2}],"parents":[],"symbol":"?","x":1,"y":1},{"children":[{"x":2,"y":2}],"parents":[],"symbol":"M","x":2,"y":1},{"children":[{"x":5,"y":2},{"x":6,"y":2}],"parents":[],"symbol":"M","x":5,"y":1},{"children":[{"x":0,"y":3}],"parents":[],"symbol":"M","x":0,"y":2},{"children":[{"x":2,"y":3}],"parents":[],"symbol":"M","x":2,"y":2},{"children":[{"x":4,"y":3},{"x":5,"y":3}],"parents":[],"symbol":"M","x":5,"y":2},{"children":[{"x":5,"y":3}],"parents":[],"symbol":"?","x":6,"y":2},{"children":[{"x":0,"y":4}],"parents":[],"symbol":"M","x":0,"y":3},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":2,"y":3},{"children":[{"x":3,"y":4}],"parents":[],"symbol":"M","x":4,"y":3},{"children":[{"x":4,"y":4},{"x":5,"y":4}],"parents":[],"symbol":"?","x":5,"y":3},{"children":[{"x":0,"y":5}],"parents":[],"symbol":"M","x":0,"y":4},{"children":[{"x":0,"y":5}],"parents":[],"symbol":"$","x":1,"y":4},{"children":[{"x":2,"y":5}],"parents":[],"symbol":"?","x":3,"y":4},{"children":[{"x":3,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":6,"y":5}],"parents":[],"symbol":"?","x":5,"y":4},{"children":[{"x":1,"y":6}],"parents":[],"symbol":"R","x":0,"y":5},{"children":[{"x":3,"y":6}],"parents":[],"symbol":"R","x":2,"y":5},{"children":[{"x":4,"y":6}],"parents":[],"symbol":"E","x":3,"y":5},{"children":[{"x":6,"y":6}],"parents":[],"symbol":"R","x":6,"y":5},{"children":[{"x":0,"y":7},{"x":1,"y":7}],"parents":[],"symbol":"M","x":1,"y":6},{"children":[{"x":2,"y":7}],"parents":[],"symbol":"M","x":3,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"R","x":4,"y":6},{"children":[{"x":5,"y":7}],"parents":[],"symbol":"M","x":6,"y":6},{"children":[{"x":1,"y":8}],"parents":[],"symbol":"?","x":0,"y":7},{"children":[{"x":2,"y":8}],"parents":[],"symbol":"R","x":1,"y":7},{"children":[{"x":2,"y":8}],"parents":[],"symbol":"$","x":2,"y":7},{"children":[{"x":4,"y":8},{"x":6,"y":8}],"parents":[],"symbol":"?","x":5,"y":7},{"children":[{"x":0,"y":9},{"x":1,"y":9}],"parents":[],"symbol":"T","x":1,"y":8},{"children":[{"x":1,"y":9}],"parents":[],"symbol":"T","x":2,"y":8},{"children":[{"x":5,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":6,"y":9}],"parents":[],"symbol":"T","x":6,"y":8},{"children":[{"x":0,"y":10}],"parents":[],"symbol":"$","x":0,"y":9},{"children":[{"x":0,"y":10},{"x":2,"y":10}],"parents":[],"symbol":"R","x":1,"y":9},{"children":[{"x":5,"y":10}],"parents":[],"symbol":"E","x":5,"y":9},{"children":[{"x":5,"y":10}],"parents":[],"symbol":"M","x":6,"y":9},{"children":[{"x":0,"y":11},{"x":1,"y":11}],"parents":[],"symbol":"M","x":0,"y":10},{"children":[{"x":3,"y":11}],"parents":[],"symbol":"E","x":2,"y":10},{"children":[{"x":4,"y":11},{"x":5,"y":11}],"parents":[],"symbol":"M","x":5,"y":10},{"children":[{"x":0,"y":12}],"parents":[],"symbol":"M","x":0,"y":11},{"children":[{"x":0,"y":12}],"parents":[],"symbol":"R","x":1,"y":11},{"children":[{"x":2,"y":12},{"x":4,"y":12}],"parents":[],"symbol":"?","x":3,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":4,"y":11},{"children":[{"x":6,"y":12}],"parents":[],"symbol":"?","x":5,"y":11},{"children":[{"x":0,"y":13},{"x":1,"y":13}],"parents":[],"symbol":"M","x":0,"y":12},{"children":[{"x":3,"y":13}],"parents":[],"symbol":"M","x":2,"y":12},{"children":[{"x":4,"y":13}],"parents":[],"symbol":"?","x":4,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"M","x":5,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"E","x":6,"y":12},{"children":[{"x":0,"y":14}],"parents":[],"symbol":"M","x":0,"y":13},{"children":[{"x":0,"y":14}],"parents":[],"symbol":"?","x":1,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"M","x":3,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"?","x":4,"y":13},{"children":[{"x":4,"y":14},{"x":5,"y":14}],"parents":[],"symbol":"M","x":5,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":0,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":4,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":5,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"},{"counter":2,"id":"NeowsBlessing","name":"Neow's Lament"}],"room_phase":"COMBAT","room_type":"MonsterRoom","screen_name":"NONE","screen_state":{},"screen_type":"NONE","seed":-3203458749581447517},"in_game":true,"ready_for_command":true})");
  const GameState game_state = game_state_from_json(json);
}

TEST(GameStateFromJsonTest, ParseCombatRewardScreen) {
  const nlohmann::json json = nlohmann::json::parse(
      R"json({"available_commands":["choose","proceed","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Hexaghost","action_phase":"WAITING_ON_USER","ascension_level":0,"choice_list":["gold","card"],"class":"IRONCLAD","current_hp":80,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"27a3cdb1-757c-4fbc-b6c5-aceab3ca4912"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"d10193f8-36a6-48c5-aeab-cb71076539bd"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"1ad7bf6d-925b-4e37-805c-e711155ab6be"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"ccf1362d-2ba6-4fa9-9aed-83c52c39fb6d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"75f93595-d378-49eb-8857-4e0d9319cf15"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"fa2490e1-be12-46cd-bbf6-70189c789668"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"716d9951-bc55-4947-bcb8-a6ed31a9e831"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"de045a30-8f0f-4d8d-9905-5c6abc733fe6"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"992263eb-01c3-4fb4-bcd4-d179fedd77ed"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","is_playable":false,"name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"9c0c5478-57b2-4086-af8d-8a73540e6fbd"}],"floor":1,"gold":99,"is_screen_up":true,"map":[{"children":[{"x":0,"y":1},{"x":2,"y":1}],"parents":[],"symbol":"M","x":1,"y":0},{"children":[{"x":3,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":0,"y":2},{"x":1,"y":2}],"parents":[],"symbol":"M","x":0,"y":1},{"children":[{"x":2,"y":2}],"parents":[],"symbol":"?","x":2,"y":1},{"children":[{"x":2,"y":2},{"x":3,"y":2}],"parents":[],"symbol":"M","x":3,"y":1},{"children":[{"x":0,"y":3}],"parents":[],"symbol":"M","x":0,"y":2},{"children":[{"x":1,"y":3}],"parents":[],"symbol":"$","x":1,"y":2},{"children":[{"x":1,"y":3},{"x":3,"y":3}],"parents":[],"symbol":"?","x":2,"y":2},{"children":[{"x":3,"y":3}],"parents":[],"symbol":"M","x":3,"y":2},{"children":[{"x":0,"y":4}],"parents":[],"symbol":"?","x":0,"y":3},{"children":[{"x":0,"y":4},{"x":2,"y":4}],"parents":[],"symbol":"?","x":1,"y":3},{"children":[{"x":3,"y":4},{"x":4,"y":4}],"parents":[],"symbol":"M","x":3,"y":3},{"children":[{"x":0,"y":5}],"parents":[],"symbol":"?","x":0,"y":4},{"children":[{"x":1,"y":5},{"x":3,"y":5}],"parents":[],"symbol":"M","x":2,"y":4},{"children":[{"x":4,"y":5}],"parents":[],"symbol":"?","x":3,"y":4},{"children":[{"x":5,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":0,"y":6}],"parents":[],"symbol":"E","x":0,"y":5},{"children":[{"x":2,"y":6}],"parents":[],"symbol":"R","x":1,"y":5},{"children":[{"x":3,"y":6}],"parents":[],"symbol":"?","x":3,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"R","x":4,"y":5},{"children":[{"x":6,"y":6}],"parents":[],"symbol":"R","x":5,"y":5},{"children":[{"x":0,"y":7},{"x":1,"y":7}],"parents":[],"symbol":"R","x":0,"y":6},{"children":[{"x":1,"y":7}],"parents":[],"symbol":"M","x":2,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"M","x":3,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"M","x":5,"y":6},{"children":[{"x":6,"y":7}],"parents":[],"symbol":"$","x":6,"y":6},{"children":[{"x":1,"y":8}],"parents":[],"symbol":"M","x":0,"y":7},{"children":[{"x":1,"y":8},{"x":2,"y":8}],"parents":[],"symbol":"$","x":1,"y":7},{"children":[{"x":4,"y":8},{"x":5,"y":8}],"parents":[],"symbol":"M","x":4,"y":7},{"children":[{"x":6,"y":8}],"parents":[],"symbol":"M","x":6,"y":7},{"children":[{"x":0,"y":9},{"x":2,"y":9}],"parents":[],"symbol":"T","x":1,"y":8},{"children":[{"x":2,"y":9}],"parents":[],"symbol":"T","x":2,"y":8},{"children":[{"x":3,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":6,"y":9}],"parents":[],"symbol":"T","x":5,"y":8},{"children":[{"x":6,"y":9}],"parents":[],"symbol":"T","x":6,"y":8},{"children":[{"x":0,"y":10}],"parents":[],"symbol":"M","x":0,"y":9},{"children":[{"x":2,"y":10},{"x":3,"y":10}],"parents":[],"symbol":"R","x":2,"y":9},{"children":[{"x":3,"y":10}],"parents":[],"symbol":"M","x":3,"y":9},{"children":[{"x":5,"y":10},{"x":6,"y":10}],"parents":[],"symbol":"M","x":6,"y":9},{"children":[{"x":1,"y":11}],"parents":[],"symbol":"R","x":0,"y":10},{"children":[{"x":3,"y":11}],"parents":[],"symbol":"?","x":2,"y":10},{"children":[{"x":3,"y":11},{"x":4,"y":11}],"parents":[],"symbol":"E","x":3,"y":10},{"children":[{"x":5,"y":11}],"parents":[],"symbol":"R","x":5,"y":10},{"children":[{"x":6,"y":11}],"parents":[],"symbol":"E","x":6,"y":10},{"children":[{"x":0,"y":12}],"parents":[],"symbol":"M","x":1,"y":11},{"children":[{"x":2,"y":12},{"x":4,"y":12}],"parents":[],"symbol":"?","x":3,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":4,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"?","x":5,"y":11},{"children":[{"x":6,"y":12}],"parents":[],"symbol":"M","x":6,"y":11},{"children":[{"x":0,"y":13}],"parents":[],"symbol":"E","x":0,"y":12},{"children":[{"x":2,"y":13}],"parents":[],"symbol":"E","x":2,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"?","x":4,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"?","x":5,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"M","x":6,"y":12},{"children":[{"x":0,"y":14}],"parents":[],"symbol":"?","x":0,"y":13},{"children":[{"x":3,"y":14}],"parents":[],"symbol":"M","x":2,"y":13},{"children":[{"x":4,"y":14},{"x":6,"y":14}],"parents":[],"symbol":"M","x":5,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":0,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":3,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":4,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":6,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"},{"counter":2,"id":"NeowsBlessing","name":"Neow's Lament"}],"room_phase":"COMPLETE","room_type":"MonsterRoom","screen_name":"COMBAT_REWARD","screen_state":{"rewards":[{"gold":15,"reward_type":"GOLD"},{"reward_type":"CARD"}]},"screen_type":"COMBAT_REWARD","seed":8347010855619195477},"in_game":true,"ready_for_command":true})json");
  const GameState game_state = game_state_from_json(json);
}

TEST(GameStateFromJsonTest, ParseCampFireScreen) {
  const nlohmann::json json = nlohmann::json::parse(
      R"json({"available_commands":["choose","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Slime Boss","action_phase":"WAITING_ON_USER","ascension_level":0,"choice_list":["rest","smith"],"class":"IRONCLAD","current_hp":32,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"b58fde63-24cc-46c7-bae0-ed20452cfb2d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"01915bfe-864f-40a2-ab56-22e8bfb7632b"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"41640b6b-655e-4606-bbcf-472035ce9c5d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"67f625d8-8cba-469c-bd5d-7b5bb0e00ee4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5f3b7449-a7c7-44c6-a742-48857d580b3f"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"cd76edce-ccc4-434c-a911-3ff31cc6d546"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"4792d4e0-5af9-4100-8e2e-e7eb086cdc6f"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"ced65c98-af26-438e-aae0-4a4eb943b5e2"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"bcf995cb-69ab-4c5c-b523-e7529c1b9c75"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5c395299-bf40-4fe9-8d5a-0a955b3e5d86"}],"floor":6,"gold":187,"is_screen_up":false,"map":[{"children":[{"x":1,"y":1}],"parents":[],"symbol":"M","x":0,"y":0},{"children":[{"x":3,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":5,"y":1}],"parents":[],"symbol":"M","x":4,"y":0},{"children":[{"x":6,"y":1}],"parents":[],"symbol":"M","x":5,"y":0},{"children":[{"x":0,"y":2}],"parents":[],"symbol":"M","x":1,"y":1},{"children":[{"x":3,"y":2},{"x":4,"y":2}],"parents":[],"symbol":"$","x":3,"y":1},{"children":[{"x":5,"y":2}],"parents":[],"symbol":"M","x":5,"y":1},{"children":[{"x":5,"y":2}],"parents":[],"symbol":"M","x":6,"y":1},{"children":[{"x":1,"y":3}],"parents":[],"symbol":"M","x":0,"y":2},{"children":[{"x":2,"y":3},{"x":4,"y":3}],"parents":[],"symbol":"?","x":3,"y":2},{"children":[{"x":5,"y":3}],"parents":[],"symbol":"M","x":4,"y":2},{"children":[{"x":5,"y":3}],"parents":[],"symbol":"?","x":5,"y":2},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":1,"y":3},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":2,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"?","x":4,"y":3},{"children":[{"x":4,"y":4},{"x":6,"y":4}],"parents":[],"symbol":"?","x":5,"y":3},{"children":[{"x":0,"y":5},{"x":2,"y":5}],"parents":[],"symbol":"M","x":1,"y":4},{"children":[{"x":4,"y":5},{"x":5,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":6,"y":5}],"parents":[],"symbol":"?","x":6,"y":4},{"children":[{"x":0,"y":6}],"parents":[],"symbol":"R","x":0,"y":5},{"children":[{"x":2,"y":6}],"parents":[],"symbol":"E","x":2,"y":5},{"children":[{"x":3,"y":6}],"parents":[],"symbol":"R","x":4,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"E","x":5,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"R","x":6,"y":5},{"children":[{"x":1,"y":7}],"parents":[],"symbol":"M","x":0,"y":6},{"children":[{"x":2,"y":7}],"parents":[],"symbol":"R","x":2,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"M","x":3,"y":6},{"children":[{"x":4,"y":7},{"x":5,"y":7},{"x":6,"y":7}],"parents":[],"symbol":"M","x":5,"y":6},{"children":[{"x":0,"y":8}],"parents":[],"symbol":"M","x":1,"y":7},{"children":[{"x":2,"y":8}],"parents":[],"symbol":"M","x":2,"y":7},{"children":[{"x":3,"y":8},{"x":4,"y":8}],"parents":[],"symbol":"M","x":4,"y":7},{"children":[{"x":5,"y":8}],"parents":[],"symbol":"?","x":5,"y":7},{"children":[{"x":6,"y":8}],"parents":[],"symbol":"$","x":6,"y":7},{"children":[{"x":0,"y":9}],"parents":[],"symbol":"T","x":0,"y":8},{"children":[{"x":1,"y":9}],"parents":[],"symbol":"T","x":2,"y":8},{"children":[{"x":3,"y":9}],"parents":[],"symbol":"T","x":3,"y":8},{"children":[{"x":4,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":4,"y":9}],"parents":[],"symbol":"T","x":5,"y":8},{"children":[{"x":5,"y":9}],"parents":[],"symbol":"T","x":6,"y":8},{"children":[{"x":1,"y":10}],"parents":[],"symbol":"M","x":0,"y":9},{"children":[{"x":1,"y":10}],"parents":[],"symbol":"?","x":1,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"?","x":3,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"E","x":4,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"M","x":5,"y":9},{"children":[{"x":0,"y":11},{"x":2,"y":11}],"parents":[],"symbol":"E","x":1,"y":10},{"children":[{"x":4,"y":11},{"x":5,"y":11}],"parents":[],"symbol":"M","x":4,"y":10},{"children":[{"x":1,"y":12}],"parents":[],"symbol":"R","x":0,"y":11},{"children":[{"x":2,"y":12}],"parents":[],"symbol":"?","x":2,"y":11},{"children":[{"x":3,"y":12},{"x":4,"y":12}],"parents":[],"symbol":"E","x":4,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":5,"y":11},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"M","x":1,"y":12},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"R","x":2,"y":12},{"children":[{"x":2,"y":13},{"x":4,"y":13}],"parents":[],"symbol":"R","x":3,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"M","x":4,"y":12},{"children":[{"x":6,"y":13}],"parents":[],"symbol":"?","x":5,"y":12},{"children":[{"x":1,"y":14},{"x":2,"y":14}],"parents":[],"symbol":"?","x":1,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"$","x":2,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"M","x":4,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"?","x":5,"y":13},{"children":[{"x":6,"y":14}],"parents":[],"symbol":"?","x":6,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":1,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":2,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":4,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":6,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"}],"room_phase":"INCOMPLETE","room_type":"RestRoom","screen_name":"NONE","screen_state":{"has_rested":false,"rest_options":["rest","smith"]},"screen_type":"REST","seed":-515379505854114691},"in_game":true,"ready_for_command":true})json");
  const GameState game_state = game_state_from_json(json);
}

TEST(GameStateFromJsonTest, ParseGameOverScreen) {
  const nlohmann::json json = nlohmann::json::parse(
      R"json({"available_commands":["proceed","key","click","wait","state"],"game_state":{"act":1,"act_boss":"Slime Boss","action_phase":"EXECUTING_ACTIONS","ascension_level":0,"class":"IRONCLAD","combat_state":{"cards_discarded_this_turn":3,"discard_pile":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"bcf995cb-69ab-4c5c-b523-e7529c1b9c75"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5f3b7449-a7c7-44c6-a742-48857d580b3f"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"f4e602f6-e770-42da-a12e-8040fad076a6"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"bfeaf6ee-d0f2-4137-af83-1a58522f280c"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","is_playable":false,"name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5c395299-bf40-4fe9-8d5a-0a955b3e5d86"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"4792d4e0-5af9-4100-8e2e-e7eb086cdc6f"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"01915bfe-864f-40a2-ab56-22e8bfb7632b"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"b58fde63-24cc-46c7-bae0-ed20452cfb2d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"41640b6b-655e-4606-bbcf-472035ce9c5d"}],"draw_pile":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"cd76edce-ccc4-434c-a911-3ff31cc6d546"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"ced65c98-af26-438e-aae0-4a4eb943b5e2"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"67f625d8-8cba-469c-bd5d-7b5bb0e00ee4"}],"exhaust_pile":[{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"a1c8f454-5906-484b-b279-4fe389eef59f"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"ca784e3d-f3ed-48d1-9619-a02a44fc9901"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"d943e910-c1ad-463e-9189-84e6a02a8fc3"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"cb910468-de38-45c6-a25d-594372f59a37"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"a3af4db1-fb2b-4820-a8ca-2f24c3f133c1"},{"cost":1,"ethereal":false,"exhausts":true,"has_target":false,"id":"Slimed","is_playable":false,"name":"Slimed","rarity":"COMMON","type":"STATUS","upgrades":0,"uuid":"8396f384-c6c6-46b8-9905-2d748c048f87"}],"hand":[],"limbo":[],"monsters":[{"block":0,"current_hp":0,"half_dead":false,"id":"AcidSlime_M","intent":"DEBUFF","is_gone":true,"last_move_id":1,"max_hp":26,"move_adjusted_damage":-1,"move_base_damage":-1,"move_hits":1,"move_id":4,"name":"Acid Slime (M)","powers":[],"second_last_move_id":2},{"block":0,"current_hp":0,"half_dead":false,"id":"AcidSlime_L","intent":"UNKNOWN","is_gone":true,"last_move_id":3,"max_hp":66,"move_adjusted_damage":-1,"move_base_damage":-1,"move_hits":1,"move_id":3,"name":"Acid Slime (L)","powers":[],"second_last_move_id":3},{"block":0,"current_hp":6,"half_dead":false,"id":"AcidSlime_M","intent":"ATTACK","is_gone":false,"last_move_id":1,"max_hp":26,"move_adjusted_damage":10,"move_base_damage":10,"move_hits":1,"move_id":2,"name":"Acid Slime (M)","powers":[{"amount":2,"id":"Vulnerable","just_applied":false,"name":"Vulnerable"}],"second_last_move_id":2}],"player":{"block":0,"current_hp":0,"energy":0,"max_hp":80,"orbs":[],"powers":[]},"times_damaged":10,"turn":12},"current_action":"DamageAction","current_hp":0,"deck":[{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"b58fde63-24cc-46c7-bae0-ed20452cfb2d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"01915bfe-864f-40a2-ab56-22e8bfb7632b"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"41640b6b-655e-4606-bbcf-472035ce9c5d"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"67f625d8-8cba-469c-bd5d-7b5bb0e00ee4"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":true,"id":"Strike_R","is_playable":false,"name":"Strike","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5f3b7449-a7c7-44c6-a742-48857d580b3f"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"cd76edce-ccc4-434c-a911-3ff31cc6d546"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"4792d4e0-5af9-4100-8e2e-e7eb086cdc6f"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"ced65c98-af26-438e-aae0-4a4eb943b5e2"},{"cost":1,"ethereal":false,"exhausts":false,"has_target":false,"id":"Defend_R","is_playable":false,"name":"Defend","rarity":"BASIC","type":"SKILL","upgrades":0,"uuid":"bcf995cb-69ab-4c5c-b523-e7529c1b9c75"},{"cost":2,"ethereal":false,"exhausts":false,"has_target":true,"id":"Bash","is_playable":false,"name":"Bash","rarity":"BASIC","type":"ATTACK","upgrades":0,"uuid":"5c395299-bf40-4fe9-8d5a-0a955b3e5d86"}],"floor":7,"gold":187,"is_screen_up":true,"map":[{"children":[{"x":1,"y":1}],"parents":[],"symbol":"M","x":0,"y":0},{"children":[{"x":3,"y":1}],"parents":[],"symbol":"M","x":2,"y":0},{"children":[{"x":5,"y":1}],"parents":[],"symbol":"M","x":4,"y":0},{"children":[{"x":6,"y":1}],"parents":[],"symbol":"M","x":5,"y":0},{"children":[{"x":0,"y":2}],"parents":[],"symbol":"M","x":1,"y":1},{"children":[{"x":3,"y":2},{"x":4,"y":2}],"parents":[],"symbol":"$","x":3,"y":1},{"children":[{"x":5,"y":2}],"parents":[],"symbol":"M","x":5,"y":1},{"children":[{"x":5,"y":2}],"parents":[],"symbol":"M","x":6,"y":1},{"children":[{"x":1,"y":3}],"parents":[],"symbol":"M","x":0,"y":2},{"children":[{"x":2,"y":3},{"x":4,"y":3}],"parents":[],"symbol":"?","x":3,"y":2},{"children":[{"x":5,"y":3}],"parents":[],"symbol":"M","x":4,"y":2},{"children":[{"x":5,"y":3}],"parents":[],"symbol":"?","x":5,"y":2},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":1,"y":3},{"children":[{"x":1,"y":4}],"parents":[],"symbol":"M","x":2,"y":3},{"children":[{"x":4,"y":4}],"parents":[],"symbol":"?","x":4,"y":3},{"children":[{"x":4,"y":4},{"x":6,"y":4}],"parents":[],"symbol":"?","x":5,"y":3},{"children":[{"x":0,"y":5},{"x":2,"y":5}],"parents":[],"symbol":"M","x":1,"y":4},{"children":[{"x":4,"y":5},{"x":5,"y":5}],"parents":[],"symbol":"M","x":4,"y":4},{"children":[{"x":6,"y":5}],"parents":[],"symbol":"?","x":6,"y":4},{"children":[{"x":0,"y":6}],"parents":[],"symbol":"R","x":0,"y":5},{"children":[{"x":2,"y":6}],"parents":[],"symbol":"E","x":2,"y":5},{"children":[{"x":3,"y":6}],"parents":[],"symbol":"R","x":4,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"E","x":5,"y":5},{"children":[{"x":5,"y":6}],"parents":[],"symbol":"R","x":6,"y":5},{"children":[{"x":1,"y":7}],"parents":[],"symbol":"M","x":0,"y":6},{"children":[{"x":2,"y":7}],"parents":[],"symbol":"R","x":2,"y":6},{"children":[{"x":4,"y":7}],"parents":[],"symbol":"M","x":3,"y":6},{"children":[{"x":4,"y":7},{"x":5,"y":7},{"x":6,"y":7}],"parents":[],"symbol":"M","x":5,"y":6},{"children":[{"x":0,"y":8}],"parents":[],"symbol":"M","x":1,"y":7},{"children":[{"x":2,"y":8}],"parents":[],"symbol":"M","x":2,"y":7},{"children":[{"x":3,"y":8},{"x":4,"y":8}],"parents":[],"symbol":"M","x":4,"y":7},{"children":[{"x":5,"y":8}],"parents":[],"symbol":"?","x":5,"y":7},{"children":[{"x":6,"y":8}],"parents":[],"symbol":"$","x":6,"y":7},{"children":[{"x":0,"y":9}],"parents":[],"symbol":"T","x":0,"y":8},{"children":[{"x":1,"y":9}],"parents":[],"symbol":"T","x":2,"y":8},{"children":[{"x":3,"y":9}],"parents":[],"symbol":"T","x":3,"y":8},{"children":[{"x":4,"y":9}],"parents":[],"symbol":"T","x":4,"y":8},{"children":[{"x":4,"y":9}],"parents":[],"symbol":"T","x":5,"y":8},{"children":[{"x":5,"y":9}],"parents":[],"symbol":"T","x":6,"y":8},{"children":[{"x":1,"y":10}],"parents":[],"symbol":"M","x":0,"y":9},{"children":[{"x":1,"y":10}],"parents":[],"symbol":"?","x":1,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"?","x":3,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"E","x":4,"y":9},{"children":[{"x":4,"y":10}],"parents":[],"symbol":"M","x":5,"y":9},{"children":[{"x":0,"y":11},{"x":2,"y":11}],"parents":[],"symbol":"E","x":1,"y":10},{"children":[{"x":4,"y":11},{"x":5,"y":11}],"parents":[],"symbol":"M","x":4,"y":10},{"children":[{"x":1,"y":12}],"parents":[],"symbol":"R","x":0,"y":11},{"children":[{"x":2,"y":12}],"parents":[],"symbol":"?","x":2,"y":11},{"children":[{"x":3,"y":12},{"x":4,"y":12}],"parents":[],"symbol":"E","x":4,"y":11},{"children":[{"x":5,"y":12}],"parents":[],"symbol":"M","x":5,"y":11},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"M","x":1,"y":12},{"children":[{"x":1,"y":13}],"parents":[],"symbol":"R","x":2,"y":12},{"children":[{"x":2,"y":13},{"x":4,"y":13}],"parents":[],"symbol":"R","x":3,"y":12},{"children":[{"x":5,"y":13}],"parents":[],"symbol":"M","x":4,"y":12},{"children":[{"x":6,"y":13}],"parents":[],"symbol":"?","x":5,"y":12},{"children":[{"x":1,"y":14},{"x":2,"y":14}],"parents":[],"symbol":"?","x":1,"y":13},{"children":[{"x":2,"y":14}],"parents":[],"symbol":"$","x":2,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"M","x":4,"y":13},{"children":[{"x":4,"y":14}],"parents":[],"symbol":"?","x":5,"y":13},{"children":[{"x":6,"y":14}],"parents":[],"symbol":"?","x":6,"y":13},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":1,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":2,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":4,"y":14},{"children":[{"x":3,"y":16}],"parents":[],"symbol":"R","x":6,"y":14}],"max_hp":80,"potions":[{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false},{"can_discard":false,"can_use":false,"id":"Potion Slot","name":"Potion Slot","requires_target":false}],"relics":[{"counter":-1,"id":"Burning Blood","name":"Burning Blood"}],"room_phase":"COMBAT","room_type":"MonsterRoom","screen_name":"DEATH","screen_state":{"score":45,"victory":false},"screen_type":"GAME_OVER","seed":-515379505854114691},"in_game":true,"ready_for_command":true})json");
  const GameState game_state = game_state_from_json(json);
}
}  // namespace sts::interface
